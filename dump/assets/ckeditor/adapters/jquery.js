/*
 Copyright (c) 2003-2015, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
!function(e){if("undefined"==typeof e)throw Error("jQuery should be loaded before CKEditor jQuery adapter.");if("undefined"==typeof CKEDITOR)throw Error("CKEditor should be loaded before CKEditor jQuery adapter.");CKEDITOR.config.jqueryOverrideVal="undefined"==typeof CKEDITOR.config.jqueryOverrideVal?!0:CKEDITOR.config.jqueryOverrideVal,e.extend(e.fn,{ckeditorGet:function(){var e=this.eq(0).data("ckeditorInstance");if(!e)throw"CKEditor is not initialized yet, use ckeditor() with a callback.";return e},ckeditor:function(t,i){if(!CKEDITOR.env.isCompatible)throw Error("The environment is incompatible.");if(!e.isFunction(t)){var n=i;i=t,t=n}var a=[];i=i||{},this.each(function(){var n=e(this),l=n.data("ckeditorInstance"),o=n.data("_ckeditorInstanceLock"),s=this,r=new e.Deferred;a.push(r.promise()),l&&!o?(t&&t.apply(l,[this]),r.resolve()):o?l.once("instanceReady",function(){setTimeout(function(){l.element?(l.element.$==s&&t&&t.apply(l,[s]),r.resolve()):setTimeout(arguments.callee,100)},0)},null,null,9999):((i.autoUpdateElement||"undefined"==typeof i.autoUpdateElement&&CKEDITOR.config.autoUpdateElement)&&(i.autoUpdateElementJquery=!0),i.autoUpdateElement=!1,n.data("_ckeditorInstanceLock",!0),l=e(this).is("textarea")?CKEDITOR.replace(s,i):CKEDITOR.inline(s,i),n.data("ckeditorInstance",l),l.on("instanceReady",function(i){var a=i.editor;setTimeout(function(){if(a.element){if(i.removeListener(),a.on("dataReady",function(){n.trigger("dataReady.ckeditor",[a])}),a.on("setData",function(e){n.trigger("setData.ckeditor",[a,e.data])}),a.on("getData",function(e){n.trigger("getData.ckeditor",[a,e.data])},999),a.on("destroy",function(){n.trigger("destroy.ckeditor",[a])}),a.on("save",function(){return e(s.form).submit(),!1},null,null,20),a.config.autoUpdateElementJquery&&n.is("textarea")&&e(s.form).length){var l=function(){n.ckeditor(function(){a.updateElement()})};e(s.form).submit(l),e(s.form).bind("form-pre-serialize",l),n.bind("destroy.ckeditor",function(){e(s.form).unbind("submit",l),e(s.form).unbind("form-pre-serialize",l)})}a.on("destroy",function(){n.removeData("ckeditorInstance")}),n.removeData("_ckeditorInstanceLock"),n.trigger("instanceReady.ckeditor",[a]),t&&t.apply(a,[s]),r.resolve()}else setTimeout(arguments.callee,100)},0)},null,null,9999))});var l=new e.Deferred;return this.promise=l.promise(),e.when.apply(this,a).then(function(){l.resolve()}),this.editor=this.eq(0).data("ckeditorInstance"),this}}),CKEDITOR.config.jqueryOverrideVal&&(e.fn.val=CKEDITOR.tools.override(e.fn.val,function(t){return function(i){if(arguments.length){var n=this,a=[],l=this.each(function(){var n=e(this),l=n.data("ckeditorInstance");if(n.is("textarea")&&l){var o=new e.Deferred;return l.setData(i,function(){o.resolve()}),a.push(o.promise()),!0}return t.call(n,i)});if(a.length){var o=new e.Deferred;return e.when.apply(this,a).done(function(){o.resolveWith(n)}),o.promise()}return l}var l=e(this).eq(0),s=l.data("ckeditorInstance");return l.is("textarea")&&s?s.getData():t.call(l)}}))}(window.jQuery);