/*
 Copyright (c) 2003-2015, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.md or http://ckeditor.com/license
*/
!function(){CKEDITOR.dialog.add("templates",function(t){function e(t,e){var n=CKEDITOR.dom.element.createFromHtml('<a href="javascript:void(0)" tabIndex="-1" role="option" ><div class="cke_tpl_item"></div></a>'),l='<table style="width:350px;" class="cke_tpl_preview" role="presentation"><tr>';return t.image&&e&&(l+='<td class="cke_tpl_preview_img"><img src="'+CKEDITOR.getUrl(e+t.image)+'"'+(CKEDITOR.env.ie6Compat?' onload="this.width=this.width"':"")+' alt="" title=""></td>'),l+='<td style="white-space:normal;"><span class="cke_tpl_title">'+t.title+"</span><br/>",t.description&&(l+="<span>"+t.description+"</span>"),l+="</td></tr></table>",n.getFirst().setHtml(l),n.on("click",function(){i(t.html)}),n}function i(e){var i=CKEDITOR.dialog.getCurrent();i.getValueOf("selectTpl","chkInsertOpt")?(t.fire("saveSnapshot"),t.setData(e,function(){i.hide();var e=t.createRange();e.moveToElementEditStart(t.editable()),e.select(),setTimeout(function(){t.fire("saveSnapshot")},0)})):(t.insertHtml(e),i.hide())}function n(t){var e=t.data.getTarget(),i=a.equals(e);if(i||a.contains(e)){var n,l=t.data.getKeystroke(),o=a.getElementsByTag("a");if(o){if(i)n=o.getItem(0);else switch(l){case 40:n=e.getNext();break;case 38:n=e.getPrevious();break;case 13:case 32:e.fire("click")}n&&(n.focus(),t.data.preventDefault())}}}var l=CKEDITOR.plugins.get("templates");CKEDITOR.document.appendStyleSheet(CKEDITOR.getUrl(l.path+"dialogs/templates.css"));var a,l="cke_tpl_list_label_"+CKEDITOR.tools.getNextNumber(),o=t.lang.templates,r=t.config;return{title:t.lang.templates.title,minWidth:CKEDITOR.env.ie?440:400,minHeight:340,contents:[{id:"selectTpl",label:o.title,elements:[{type:"vbox",padding:5,children:[{id:"selectTplText",type:"html",html:"<span>"+o.selectPromptMsg+"</span>"},{id:"templatesList",type:"html",focus:!0,html:'<div class="cke_tpl_list" tabIndex="-1" role="listbox" aria-labelledby="'+l+'"><div class="cke_tpl_loading"><span></span></div></div><span class="cke_voice_label" id="'+l+'">'+o.options+"</span>"},{id:"chkInsertOpt",type:"checkbox",label:o.insertOption,"default":r.templates_replaceContent}]}]}],buttons:[CKEDITOR.dialog.cancelButton],onShow:function(){var t=this.getContentElement("selectTpl","templatesList");a=t.getElement(),CKEDITOR.loadTemplates(r.templates_files,function(){var i=(r.templates||"default").split(",");if(i.length){var n=a;n.setHtml("");for(var l=0,s=i.length;s>l;l++)for(var c=CKEDITOR.getTemplates(i[l]),d=c.imagesPath,c=c.templates,h=c.length,u=0;h>u;u++){var g=e(c[u],d);g.setAttribute("aria-posinset",u+1),g.setAttribute("aria-setsize",h),n.append(g)}t.focus()}else a.setHtml('<div class="cke_tpl_empty"><span>'+o.emptyListMsg+"</span></div>")}),this._.element.on("keydown",n)},onHide:function(){this._.element.removeListener("keydown",n)}}})}();